<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="tms_waybill_template" inherit_id="l10n_mx_edi.cfdiv33">
        <xpath expr="//*[name()='cfdi:Comprobante']" position="attributes" t-if="record.waybill_ids">
            <attribute name="t-att-xmlns__cartaporte">"http://www.sat.gob.mx/CartaPorte" if record.waybill_ids else False</attribute>
        </xpath>
        <xpath expr="*" position="inside">
            <t t-if="record.waybill_ids">
                <cfdi:Complemento
                    xmlns:cfdi="http://www.sat.gob.mx/cfd/3"
                    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
                    <cartaporte:CartaPorte
                        xmlns:cartaporte="http://www.sat.gob.mx/CartaPorte"
                        xsi:schemaLocation="http://www.sat.gob.mx/sitio_internet/cfd/CartaPorte/CartaPorte.xsd"
                        version="1.0"
                        t-att-TranspInternac="record.waybill_ids.l10n_mx_edi_international"
                        t-att-EntradaSalidaMerc="record.waybill_ids.l10n_mx_edi_international_type"
                        t-att-ViaEntradaSalida="record.waybill_ids.l10n_mx_edi_transport_type"
                        t-att-TotalDistRec="">
                            <cartaporte:Ubicaciones>
                                <cartaporte:Ubicacion
                                    t-att-TipoEstacion="record.waybill_ids.l10n_mx_edi_station_type">
                                    <cartaporte:Origen
                                        t-att-IDOrigen="'OR' + str(record.waybill_ids.departure_address_id.id).zfill(6)"
                                        t-att-RFCRemitente="record.waybill_ids.departure_address_id.vat if record.waybill_ids.departure_address_id.country_id == ref('base.mx') else False"
                                        t-att-NombreRemitente="record.waybill_ids.departure_address_id.name"
                                        t-att-NumRegIdTrib="record.waybill_ids.departure_address_id.vat if record.waybill_ids.departure_address_id.country_id != ref('base.mx') else False"
                                        t-att-ResidenciaFiscal="record.waybill_ids.departure_address_id.country_id.l10n_mx_edi_code if record.waybill_ids.departure_address_id.country_id != ref('base.mx') else False"
                                        t-att-NumEstacion="record.waybill_ids.l10n_mx_edi_departure_station_id.code if record.waybill_ids.l10n_mx_edi_station_type in ['02', '03', '04'] else False"
                                        t-att-NombreEstacion="record.waybill_ids.l10n_mx_edi_departure_station_id.name if record.waybill_ids.l10n_mx_edi_station_type in ['02', '03', '04'] else False"
                                        t-att-NavegacionTrafico="record.waybill_ids.l10n_mx_edi_departure_port_type if record.waybill_ids.l10n_mx_edi_station_type == '02' else False"
                                        t-att-FechaHoraSalida="record.waybill_ids.l10n_mx_edi_departure_date.strftime('%Y-%m-%dT%H:%M:%S')"
                                    />
                                    <cartaporte:Domicilio
                                        t-att-Calle="record.waybill_ids.departure_address_id.street_name"
                                        t-att-NumeroExterior="record.waybill_ids.departure_address_id.street_number"
                                        t-att-NumeroInterior="record.waybill_ids.departure_address_id.street_number2"
                                        t-att-Colonia="record.waybill_ids.departure_address_id.l10n_mx_edi_colony"
                                        t-att-Localidad="record.waybill_ids.departure_address_id.l10n_mx_edi_locality"
                                        t-att-Referencia="record.waybill_ids.departure_address_id.ref"
                                        t-att-Municipio="record.waybill_ids.departure_address_id.city"
                                        t-att-Estado="record.waybill_ids.departure_address_id.state_id.l10n_mx_edi_code"
                                        t-att-Pais="record.waybill_ids.departure_address_id.country_id.l10n_mx_edi_code"
                                        t-att-CodigoPostal="ecord.waybill_ids.departure_address_id.zip"
                                    />
                                </cartaporte:Ubicacion>
                                <cartaporte:Ubicacion
                                    t-att-TipoEstacion="record.waybill_ids.l10n_mx_edi_station_type"
                                    t-att-DistanciaRecorrida="">
                                    <cartaporte:Destino
                                        t-att-IDDestino="'DE' + str(record.waybill_ids.arrival_address_id.id).zfill(6)"
                                        t-att-RFCDestinatario="record.waybill_ids.arrival_address_id.vat if record.waybill_ids.arrival_address_id.country_id == ref('base.mx') else False"
                                        t-att-NombreDestinatario="record.waybill_ids.arrival_address_id.name"
                                        t-att-NumRegIdTrib="record.waybill_ids.arrival_address_id.vat if record.waybill_ids.arrival_address_id.country_id != ref('base.mx') else False"
                                        t-att-ResidenciaFiscal="record.waybill_ids.arrival_address_id.country_id.l10n_mx_edi_code if record.waybill_ids.arrival_address_id.country_id != ref('base.mx') else False"
                                        t-att-NumEstacion="record.waybill_ids.l10n_mx_edi_arrival_station_id.code if record.waybill_ids.l10n_mx_edi_station_type in ['02', '03', '04'] else False"
                                        t-att-NombreEstacion="record.waybill_ids.l10n_mx_edi_arrival_station_id.name if record.waybill_ids.l10n_mx_edi_station_type in ['02', '03', '04'] else False"
                                        t-att-NavegacionTrafico="record.waybill_ids.l10n_mx_edi_arrival_port_type if record.waybill_ids.l10n_mx_edi_station_type == '02' else False"
                                        t-att-FechaHoraProgLlegada="record.waybill_ids.l10n_mx_edi_arrival_date.strftime('%Y-%m-%dT%H:%M:%S')"
                                    />
                                    <cartaporte:Domicilio
                                        t-att-Calle="record.waybill_ids.arrival_address_id.street_name"
                                        t-att-NumeroExterior="record.waybill_ids.arrival_address_id.street_number"
                                        t-att-NumeroInterior="record.waybill_ids.arrival_address_id.street_number2"
                                        t-att-Colonia="record.waybill_ids.arrival_address_id.l10n_mx_edi_colony"
                                        t-att-Localidad="record.waybill_ids.arrival_address_id.l10n_mx_edi_locality"
                                        t-att-Referencia="record.waybill_ids.arrival_address_id.ref"
                                        t-att-Municipio="record.waybill_ids.arrival_address_id.city"
                                        t-att-Estado="record.waybill_ids.arrival_address_id.state_id.l10n_mx_edi_code"
                                        t-att-Pais="record.waybill_ids.arrival_address_id.country_id.l10n_mx_edi_code"
                                        t-att-CodigoPostal="ecord.waybill_ids.arrival_address_id.zip"
                                    />
                                </cartaporte:Ubicacion>
                            </cartaporte:Ubicaciones>
                            <cartaporte:Mercancias
                                t-att-PesoBrutoTotal=""
                                t-att-UnidadPeso=""
                                t-att-PesoNetoTotal=""
                                t-att-NumTotalMercancias=""
                                t-att-CargoPorTasacion="">
                                <cartaporte:Mercancia
                                    t-att-BienesTransp=""
                                    t-att-ClaveSTCC=""
                                    t-att-Descripcion=""
                                    t-att-Cantidad=""
                                    t-att-ClaveUnidad=""
                                    t-att-Unidad=""
                                    t-att-Dimensiones=""
                                    t-att-MaterialPeligroso=""
                                    t-att-CveMaterialPeligroso=""
                                    t-att-Embalaje=""
                                    t-att-DescripEmbalaje=""
                                    t-att-PesoEnKg=""
                                    t-att-ValorMercancia=""
                                    t-att-Moneda=""
                                    t-att-FraccionArancelaria=""
                                    t-att-UUIDComercioExt="">
                                    <cartaporte:CantidadTransporta
                                        t-att-Cantidad=""
                                        t-att-IDOrigen=""
                                        t-att-IDDestino=""
                                        t-att-CvesTransporte=""/>
                                    <cartaporte:DetalleMercancia
                                        t-att-UnidadPeso=""
                                        t-att-PesoBruto=""
                                        t-att-PesoNeto=""
                                        t-att-PesoTara=""
                                        t-att-NumPiezas=""/>
                                </cartaporte:Mercancia>
                                <cartaporte:AutotransporteFederal
                                    t-att-PermSCT=""
                                    t-att-NumPermisoSCT=""
                                    t-att-NombreAseg=""
                                    t-att-NumPolizaSeguro="">
                                    <cartaporte:IdentificacionVehicular
                                        t-att-ConfigVehicular=""
                                        t-att-PlacaVM=""
                                        t-att-AnioModeloVM=""/>
                                    <cartaporte:Remolques>
                                        <cartaporte:Remolque
                                            t-att-SubTipoRem=""
                                            t-att-Placa=""/>
                                    </cartaporte:Remolques>
                                </cartaporte:AutotransporteFederal>
                                <cartaporte:TransporteMaritimo
                                    t-att-PermSCT=""
                                    t-att-NumPermisoSCT=""
                                    t-att-NombreAseg=""
                                    t-att-NumPolizaSeguro=""
                                    t-att-TipoEmbarcacion=""
                                    t-att-Matricula=""
                                    t-att-NumeroOMI=""
                                    t-att-AnioEmbarcacion=""
                                    t-att-NombreEmbarc=""
                                    t-att-NacionalidadEmbarc=""
                                    t-att-UnidadesDeArqBruto=""
                                    t-att-TipoCarga=""
                                    t-att-NumCertITC=""
                                    t-att-Eslora=""
                                    t-att-Manga=""
                                    t-att-Calado=""
                                    t-att-LineaNaviera=""
                                    t-att-NombreAgenteNaviero=""
                                    t-att-NumAutorizacionNaviero=""
                                    t-att-NumViaje=""
                                    t-att-NumConocEmbarc="">
                                    <cartaporte:Contenedor
                                        t-att-MatriculaContenedor=""
                                        t-att-TipoContenedor=""
                                        t-att-NumPrecinto=""/>
                                </cartaporte:TransporteMaritimo>
                                <cartaporte:TransporteAereo
                                    t-att-PermSCT=""
                                    t-att-NumPermisoSCT=""
                                    t-att-NombreAseg=""
                                    t-att-NumPolizaSeguro=""
                                    t-att-NumeroGuia=""
                                    t-att-LugarContrato=""
                                    t-att-RFCTransportista=""
                                    t-att-CodigoTransportista=""
                                    t-att-NumRegIdTribTranspor=""
                                    t-att-ResidenciaFiscalTranspor=""
                                    t-att-NombreTransportista=""
                                    t-att-RFCEmbarcador=""
                                    t-att-NumRegIdTribEmbarc=""
                                    t-att-ResidenciaFiscalEmbarc=""
                                    t-att-NombreEmbarcador=""/>
                                <cartaporte:TransporteFerroviario
                                    t-att-TipoDeServicio=""
                                    t-att-NombreAseg=""
                                    t-att-NumPolizaSeguro=""
                                    t-att-Concesionario="">
                                    <cartaporte:DerechosDePaso
                                        t-att-TipoDerechoDePaso=""
                                        t-att-KilometrajePagado=""/>
                                    <cartaporte:Carro
                                        t-att-TipoCarro=""
                                        t-att-MatriculaCarro=""
                                        t-att-GuiaCarro=""
                                        t-att-ToneladasNetasCarro="">
                                        <cartaporte:Contenedor
                                            t-att-TipoContenedor=""
                                            t-att-PesoContenedorVacio=""
                                            t-att-PesoNetoMercancia=""
                                            />
                                    </cartaporte:Carro>
                                </cartaporte:TransporteFerroviario>
                            </cartaporte:Mercancias>
                            <cartaporte:FiguraTransporte
                                t-att-CveTransporte="">
                                <cartaporte:Operadores>
                                    <cartaporte:Operador
                                        t-att-RFCOperador=""
                                        t-att-NumLicencia=""
                                        t-att-NombreOperador=""
                                        t-att-NumRegIdTribOperador=""
                                        t-att-ResidenciaFiscalOperador="">
                                        <cartaporte:Domicilio
                                            t-att-Calle=""
                                            t-att-NumeroExterior=""
                                            t-att-NumeroInterior=""
                                            t-att-Colonia=""
                                            t-att-Localidad=""
                                            t-att-Referencia=""
                                            t-att-Municipio=""
                                            t-att-Estado=""
                                            t-att-Pais=""
                                            t-att-CodigoPostal=""/>
                                    </cartaporte:Operador>
                                </cartaporte:Operadores>
                                <cartaporte:Propietario
                                    t-att-RFCPropietario=""
                                    t-att-NombrePropietario=""
                                    t-att-NumRegIdTribPropietario=""
                                    t-att-ResidenciaFiscalPropietario="">
                                    <cartaporte:Domicilio
                                        t-att-Calle=""
                                        t-att-NumeroExterior=""
                                        t-att-NumeroInterior=""
                                        t-att-Colonia=""
                                        t-att-Localidad=""
                                        t-att-Referencia=""
                                        t-att-Municipio=""
                                        t-att-Estado=""
                                        t-att-Pais=""
                                        t-att-CodigoPostal=""/>
                                </cartaporte:Propietario>
                                <cartaporte:Arrendatario
                                    t-att-RFCArrendatario=""
                                    t-att-NombreArrendatario=""
                                    t-att-NumRegIdTribArrendatario=""
                                    t-att-ResidenciaFiscalArrendatario="">
                                    <cartaporte:Domicilio
                                        t-att-Calle=""
                                        t-att-NumeroExterior=""
                                        t-att-NumeroInterior=""
                                        t-att-Colonia=""
                                        t-att-Localidad=""
                                        t-att-Referencia=""
                                        t-att-Municipio=""
                                        t-att-Estado=""
                                        t-att-Pais=""
                                        t-att-CodigoPostal=""/>
                                </cartaporte:Arrendatario>
                                <cartaporte:Notificado
                                    t-att-RFCNotificado=""
                                    t-att-NombreNotificado=""
                                    t-att-NumRegIdTribNotificado=""
                                    t-att-ResidenciaFiscalNotificado="">
                                    <cartaporte:Domicilio
                                        t-att-Calle=""
                                        t-att-NumeroExterior=""
                                        t-att-NumeroInterior=""
                                        t-att-Colonia=""
                                        t-att-Localidad=""
                                        t-att-Referencia=""
                                        t-att-Municipio=""
                                        t-att-Estado=""
                                        t-att-Pais=""
                                        t-att-CodigoPostal=""/>
                                </cartaporte:Notificado>
                            </cartaporte:FiguraTransporte>
                    </cartaporte:CartaPorte>
                </cfdi:Complemento>
            </t>
        </xpath>
    </template>
</odoo>
